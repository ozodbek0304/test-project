import{f as N,j as e,B as w,ac as S,I as q,K as F,z as h,i as M,k as Q,u as z,m as E,b as I,t as K,P,g as T,C as _,J as C,c as B}from"./index-BuAxSJaU.js";import{D as J}from"./datatable-BQkt-0G4.js";import{A as L,T as $}from"./trash-2-DM4hDO8P.js";import{C as G}from"./checkbox-BA3PB9sW.js";import{u as H}from"./useRoles-Bsg_oAYG.js";import{u as O}from"./useConfirm-C4TJzy_o.js";import"./cursor-pagination-BTjgdc8e.js";import"./pagination-BuI0EWJ8.js";const U=()=>{const o=N();return[{header:"Nomi",accessorKey:"name"},{header:" ",cell:({row:d})=>e.jsx(w,{icon:e.jsx(L,{width:18}),className:"!text-primary w-full",size:"icon",variant:"ghost",onClick:()=>o({search:{role:d.original.id}})})}]};function V({name:o,label:d,disabled:n,control:x,required:g,hideError:y=!0}){var j,b;return e.jsxs("div",{children:[e.jsx(S,{name:o,control:x,render:({field:c})=>{var l;return e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(G,{checked:c.value,onCheckedChange:c.onChange,disabled:n||c.disabled,className:"",id:o}),e.jsx(q,{htmlFor:o,required:!!g,isError:!!((l=x._formState.errors)!=null&&l[o]),className:"pb-0",children:d})]})}}),!y&&((j=x._formState.errors)==null?void 0:j[o])&&e.jsx(F,{children:(b=x._formState.errors[o])==null?void 0:b.message})]})}const W=()=>{const o=N(),d=M(),n=Q({from:"/_main"}),{post:x,patch:g,remove:y,isPending:j}=z(),b=O(),{roles:c}=H(),{data:l}=E("users/sections/"),f=c==null?void 0:c.find(s=>s.id==n.role),r=l==null?void 0:l.flatMap(s=>{var i;return(i=s.modules)==null?void 0:i.flatMap(t=>t.actions)}),p=I({resolver:K(X),disabled:j,values:(n==null?void 0:n.role)==="new"?{name:"",actions:r==null?void 0:r.map(s=>({id:s.id,isChecked:!1}))}:{name:f==null?void 0:f.name,actions:r==null?void 0:r.map(s=>{var i;return{id:s.id,isChecked:!!((i=f==null?void 0:f.actions)!=null&&i.find(t=>t==s.id))}})}});async function k(s){var v;const i=(v=s.actions)==null?void 0:v.filter(a=>a.isChecked).map(a=>a.id).filter(a=>a!==void 0),t={name:s==null?void 0:s.name,actions:i};n.role==="new"?(await x("users/roles/",t),d.invalidateQueries({queryKey:["users/roles/"]}),C.success("Muvaffaqiyatli qo'shildi"),o({search:{role:void 0}}),p.reset()):(await g("users/roles/"+n.role+"/",t),d.setQueryData(["users/roles/"],a=>a==null?void 0:a.map(m=>m.id==n.role?{...m,name:s.name,actions:r==null?void 0:r.filter(u=>i==null?void 0:i.includes(u.id)).map(u=>u.id)}:m)),p.reset())}async function R(){await b({title:"Sabab?"})&&(await y(`users/roles/${n.role}/`),C.success("Muvaffaqiyatli o'chirildi"),d.setQueryData(["users/roles/"],i=>i==null?void 0:i.filter(t=>t.id!=n.role)),o({search:{role:void 0}}))}return e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start gap-4 w-full ",children:[e.jsxs("div",{className:"md:max-w-sm w-full space-y-4",children:[e.jsx(w,{icon:e.jsx(P,{width:18}),onClick:()=>{o({search:{role:"new"}}),p.reset({name:"",actions:[]})},children:"Rol"}),e.jsx(J,{columns:U(),data:c,viewAll:!0})]}),!!n.role&&e.jsx("div",{className:"flex flex-col gap-4 items-end w-full mt-14",children:e.jsxs("form",{onSubmit:p.handleSubmit(k),className:"p-4 space-y-4 rounded-lg border border-border w-full relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx(T,{methods:p,name:"name",label:"Nomi",wrapperClassName:"max-w-xs"}),!isNaN(n.role)&&e.jsx(w,{type:"button",variant:"destructive",icon:e.jsx($,{width:16}),onClick:R,children:"Rolni o'chirish"})]}),e.jsx("div",{className:"space-y-8",children:l==null?void 0:l.map(s=>{var i;return e.jsxs("div",{children:[e.jsx("h2",{className:"font-medium text-xl pb-3",children:s.name}),e.jsx("div",{className:"space-y-3 md:space-y-2",children:(i=s.modules)==null?void 0:i.map(t=>{var v;return e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-x-10 gap-y-1",children:[e.jsx("h4",{className:"text-muted-foreground",children:t.name}),e.jsx("div",{className:"flex flex-wrap items-center gap-4",children:(v=r==null?void 0:r.filter(a=>{var m;return(m=t.actions)==null?void 0:m.find(u=>u.id==a.id)}))==null?void 0:v.map((a,m)=>e.jsx(V,{control:p.control,name:`actions.${r==null?void 0:r.findIndex(u=>u.id==a.id)}.isChecked`,label:a.name},m))})]},t.id)})})]},s.id)})}),e.jsx(w,{type:"submit",icon:e.jsx(_,{width:16}),loading:j,children:"Saqlash"})]})})]})})},X=h.object({name:h.string({message:""}).min(1,"Nomini kiriting"),actions:h.array(h.object({id:h.number().optional(),name:h.string().optional(),isChecked:h.boolean().optional()})).optional().nullable()}),ae=B("/_main/_admin/roles")({component:()=>e.jsx(W,{})});export{ae as Route};
