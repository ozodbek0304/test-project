import{H as G,k as q,j as s,l as z,L as V,B as f,P,r as k,x as w,I as U,K as W,z as o,i as K,u as R,J as _,b as T,t as E,D as M,M as X,p as I,q as L,s as A,V as Y,v as $,g as N,F as H,m as Z,y as D,c as ee}from"./index-BuAxSJaU.js";import{P as se}from"./tabs-xOTve4x4.js";import{C as ae}from"./collapsible-table-Cv61XwvC.js";import{S as ie}from"./see-in-view-BUqfdvd-.js";import{f as F}from"./format-phone-number-BkVnJ-Jf.js";import{F as le}from"./file-upload2-BeYo5MeU.js";import{F as B}from"./phone-number-DAgSYITq.js";import"./badge-EKaIYskS.js";import"./cursor-pagination-BTjgdc8e.js";import"./pagination-BuI0EWJ8.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=G("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),ne=({onAdd:c,onEdit:i})=>{const a=q({from:"/_main"});return[{header:"№",cell:({row:e})=>e.original.name?e.index+1:""},{header:"Buyurtmachi",cell:({row:e})=>{var t;return(t=e.original)!=null&&t.id?s.jsxs("div",{className:"flex flex-col text-sm",children:[s.jsx("span",{children:e.original.name}),s.jsx("span",{className:"text-muted-foreground",children:F(e.original.phone)})]}):""}},{header:"Qayerdan",accessorKey:"loading.name",cell:e=>e.renderValue()},{header:"Qayerga",accessorKey:"unloading.name",cell:e=>e.renderValue()},{header:"Summa",accessorKey:"amount",cell:e=>e.getValue()&&z(`${e.getValue()}`)},{header:"Amallar",cell:({row:e})=>s.jsx(V,{search:{...a,client:e.original.id},children:e.original.name?s.jsx(f,{icon:s.jsx(P,{width:18}),size:"sm",variant:"ghost",className:"!text-green-500",onClick:()=>{e.toggleExpanded(),c()}}):s.jsx(f,{icon:s.jsx(O,{width:18}),size:"sm",variant:"ghost",className:"!text-primary",onClick:()=>i(e.original)})})}]},te=({onAdd:c,onEdit:i})=>{const a=q({from:"/_main"});return[{header:"№",cell:({row:e})=>e.original.name?e.index+1:""},{header:"Buyurtmachi",cell:({row:e})=>{var t;return(t=e.original)!=null&&t.name?s.jsxs("div",{className:"flex flex-col text-sm",children:[s.jsx("span",{children:e.original.name}),s.jsx("span",{className:"text-muted-foreground",children:F(e.original.phone)})]}):""}},{header:"Rekvizit",cell:({row:e})=>{var t;return e.original.requisite?e.original.requisite:((t=e.original)==null?void 0:t.name)&&s.jsx(ie,{url:e.original.requisite_file,className:"w-8 h-8 rounded object-cover"})}},{header:"Tashuvchi",accessorKey:"customer"},{header:"INN",accessorKey:"inn"},{header:"Buxgalter raqami",cell:({row:e})=>s.jsx("a",{href:`tel:${e.original.accounting_phone}`,className:"flex items-center gap-2 w-max",children:F(e.original.accounting_phone)})},{header:"Qayerdan",accessorKey:"loading.name",cell:e=>e.renderValue()},{header:"Qayerga",accessorKey:"unloading.name",cell:e=>e.renderValue()},{header:"Summa",accessorKey:"amount",cell:e=>e.getValue()&&z(`${e.getValue()}`)},{header:"Amallar",cell:({row:e})=>s.jsx(V,{search:{...a,client:e.original.id},children:e.original.name?s.jsx(f,{icon:s.jsx(P,{width:18}),size:"sm",variant:"ghost",className:"!text-green-500",onClick:()=>{e.toggleExpanded(),c()}}):s.jsx(f,{icon:s.jsx(O,{width:18}),size:"sm",variant:"ghost",className:"!text-primary",onClick:()=>i(e.original)})})}]},J=k.forwardRef(({className:c,...i},a)=>s.jsx("textarea",{className:w("flex min-h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50",c),ref:a,...i}));J.displayName="Textarea";function oe({methods:c,name:i,label:a,required:e=!1,registerOptions:t,wrapperClassName:h,className:d,hideError:n=!0,...u}){var j,y;const{register:r,formState:{errors:l}}=c,p=r(i,{required:{value:e,message:(j=c.formState.errors[i])==null?void 0:j.message},...t,disabled:u.disabled}),{disabled:S,...C}=u;return s.jsxs("fieldset",{className:w("flex flex-col w-full",h),children:[a&&s.jsx(U,{htmlFor:i,required:e,isError:!!(l!=null&&l[i]),children:a}),s.jsx(J,{...p,...C,disabled:S||c.formState.disabled,placeholder:u.placeholder||a,id:i,className:l!=null&&l[i]&&!a?"border-destructive focus:border-border !ring-destructive":""}),!n&&l[i]&&s.jsx(W,{children:(y=l[i])==null?void 0:y.message})]})}const re=({open:c,setOpen:i})=>{const a=q({from:"/_main"}),e=K(),t=a!=null&&a.type?a==null?void 0:a.type:"cash",{post:h,isPending:d}=R({onSuccess:r=>{e.setQueryData(["clients/",{...a,type:t}],l=>{var p;return{...l,results:((p=l==null?void 0:l.results)==null?void 0:p.length)>0?[r,...l.results]:[r]}}),e.setQueryData(["orders/clients/"],l=>[r,...l]),e.invalidateQueries({queryKey:["accountant/clients/",a]}),_.success("Muvaffaqiyatli qo'shildi"),i(!1),n.reset()}},{contentType:"multipart/form-data"}),n=T({resolver:E(ce),disabled:d});async function u(r){r.requisite||r.requisite_file||t==="cash"?await h("clients/",{...r,type:t}):_.error("Rekvizit kiritilmadi")}return s.jsxs(M,{open:c,onOpenChange:i,children:[s.jsx(X,{asChild:!0,onClick:()=>i(!0),children:s.jsx(f,{icon:s.jsx(P,{width:20}),children:"Buyurtmachi"})}),s.jsxs(I,{className:"max-w-2xl",children:[s.jsxs(L,{children:[s.jsx(A,{children:"Yangi buyurtmachi"}),s.jsx(Y,{children:s.jsx($,{children:"Buyurtmachi qo'shish"})})]}),s.jsxs("form",{onSubmit:n.handleSubmit(u),className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center flex-col md:flex-row gap-4",children:[s.jsx(N,{methods:n,name:"name",label:"Buyurtmachi"}),s.jsx(B,{control:n.control,name:"phone",label:"Buyurtmachi raqami"})]}),s.jsxs("div",{className:"flex items-center flex-col md:flex-row gap-4",children:[s.jsx(N,{methods:n,name:"loading",label:"Qayerdan"}),s.jsx(N,{methods:n,name:"unloading",label:"Qayerga"})]}),s.jsxs("div",{className:"flex items-center flex-col md:flex-row gap-4",children:[s.jsx(H,{control:n.control,name:"amount",thousandSeparator:"  ",label:"Summa"}),a.type==="transfer"&&s.jsx(B,{control:n.control,name:"accounting_phone",label:"Buxgalter raqami"})]}),a.type==="transfer"&&s.jsx(oe,{methods:n,name:"requisite",label:"Rekvizit"}),a.type=="transfer"&&s.jsx(le,{control:n.control,name:"requisite_file",wrapperClassName:"!min-w-full",multiple:!1}),s.jsxs("div",{className:"flex gap-4 justify-end",children:[s.jsx(f,{loading:d,children:"Saqlash"}),s.jsx(f,{type:"button",variant:"secondary",onClick:()=>i(!1),disabled:d,children:"Bekor qilish"})]})]})]})]})},ce=o.object({name:o.string().min(1),phone:o.string().length(12),loading:o.string().min(1).or(o.number().min(1)),unloading:o.string().min(1).or(o.number().min(1)),amount:o.string().min(1).or(o.number().min(1)),accounting_phone:o.string().optional(),requisite:o.string().optional(),requisite_file:o.instanceof(Blob).or(o.string()).optional()}),me=({open:c,setOpen:i,current:a})=>{var p,S,C,j,y;const e=q({from:"/_main"}),t=K(),h=e!=null&&e.type?e==null?void 0:e.type:"cash",{post:d,patch:n,isPending:u}=R({onSuccess:g=>{a!=null&&a.id?(t.setQueryData(["clients/",{...e,type:h}],x=>{var b;return{...x,results:(b=x==null?void 0:x.results)==null?void 0:b.map(m=>{var v;return m.id==(g==null?void 0:g.client)?{...m,routes:(v=m==null?void 0:m.routes)==null?void 0:v.map(Q=>Q.id==(a==null?void 0:a.id)?g:Q)}:m})}}),_.success("Muvaffaqiyatli tahrirlandi")):(t.setQueryData(["clients/",{...e,type:h}],x=>{var b;return{...x,results:(b=x==null?void 0:x.results)==null?void 0:b.map(m=>{var v;return m.id==+e.client?{...m,routes:(v=m==null?void 0:m.routes)!=null&&v.length?[g,...m.routes]:[g]}:m})}}),_.success("Muvaffaqiyatli qo'shildi")),i(!1)}}),r=T({resolver:E(de),disabled:u,values:{...a,loading:(p=a==null?void 0:a.loading)==null?void 0:p.name,unloading:(S=a==null?void 0:a.unloading)==null?void 0:S.name,amount:(y=(j=(C=a==null?void 0:a.amount)==null?void 0:C.toString())==null?void 0:j.split("."))==null?void 0:y[0]}});async function l(g){a!=null&&a.id?await n(`clients/routes/${a==null?void 0:a.id}/`,{...g,amount:+g.amount||(a==null?void 0:a.amount)}):await d("clients/routes/",{...g,client:e.client,type:h})}return s.jsx(M,{open:c,onOpenChange:i,children:s.jsxs(I,{className:"max-w-2xl",children:[s.jsxs(L,{children:[s.jsx(A,{children:a!=null&&a.id?"Yo'nalishni tahrirlash":"Yangi yo'nalish"}),s.jsx(Y,{children:s.jsx($,{children:a!=null&&a.id?"Yo'nalishni tahrirlash":"Yangi yo'nalish"})})]}),s.jsxs("form",{onSubmit:r.handleSubmit(l),className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx(N,{methods:r,name:"loading",label:"Qayerdan"}),s.jsx(N,{methods:r,name:"unloading",label:"Qayerga"})]}),s.jsx(H,{control:r.control,name:"amount",label:"Summa",thousandSeparator:"  "}),s.jsxs("div",{className:"flex gap-4 justify-end",children:[s.jsx(f,{loading:u,children:"Saqlash"}),s.jsx(f,{type:"button",variant:"secondary",onClick:()=>i(!1),disabled:u,children:"Bekor qilish"})]})]})]})})},de=o.object({loading:o.string().min(1),unloading:o.string().min(1),amount:o.string({message:""}).or(o.number().min(1))}),ue=()=>{var r;const[c,i]=k.useState(!1),[a,e]=k.useState(!1),[t,h]=k.useState(),d=q({from:"/_main"}),{data:n,isLoading:u}=Z("clients/",{...d,type:d.type?d.type:"cash"},{refetchOnMount:!0,refetchOnWindowFocus:!0});return s.jsxs("div",{children:[s.jsx(ae,{columns:d.type==="transfer"?te({onAdd:()=>e(!0),onEdit:l=>{h(l),e(!0)}}):ne({onAdd:()=>e(!0),onEdit:l=>{h(l),e(!0)}}),data:(r=n==null?void 0:n.results)==null?void 0:r.map(l=>({...l,subRows:l.routes})),paginationProps:{totalPages:(n==null?void 0:n.total_pages)||1},loading:u,head:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(se,{paramName:"type",options:[{label:"Naqd",value:"cash"},{label:"Pul o'tkazish",value:"transfer"}]}),D("clients/")&&s.jsx(re,{open:c,setOpen:i})]})}),s.jsx(me,{open:a,setOpen:e,current:t})]})},qe=ee("/_main/_manager/orderer")({component:()=>s.jsx(ue,{})});export{qe as Route};
