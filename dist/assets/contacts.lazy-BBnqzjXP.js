import{j as e,I as T,ac as S,ad as F,x as v,K as P,z as f,i as y,k,u as C,b as $,t as A,r as j,D as M,p as R,q as E,s as D,v as I,g as O,B as b,P as N,J as _,a as Q,y as z,m as K,c as U}from"./index-BuAxSJaU.js";import{F as G}from"./format-number-input-Dhf-qfk7.js";import{F as p}from"./file-upload2-BeYo5MeU.js";import{P as w,S as V}from"./see-more-Ef9pY5VC.js";import{C as Z,c as B}from"./card-DPoa1Zzb.js";import{u as H}from"./useConfirm-C4TJzy_o.js";import{f as J}from"./format-phone-number-BkVnJ-Jf.js";import{T as L}from"./trash-2-DM4hDO8P.js";import{S as Y}from"./send-82Fj3iRs.js";import{P as W}from"./pagination-BuI0EWJ8.js";import{u as X,D as ee}from"./useDownloadAsExcel-B0QCkxlR.js";import{P as se}from"./combobox-BXG5K80F.js";import"./badge-EKaIYskS.js";function ae({name:s,label:n,placeholder:a,disabled:d,required:x,hideError:m=!0,control:c}){var o,u,i;const h=t=>{if(!t)return"";const l=t.replace(/[^a-zA-Z0-9]/g,"").toUpperCase(),r=l.slice(0,2),q=l.slice(2).replace(/([A-Za-z])(?=\d)|(\d)(?=[A-Za-z])/g,"$1$2 ");return`${r} ${q}`.trim().slice(0,11).trim()};return e.jsxs("div",{className:"w-full space-y-2",children:[n&&e.jsx(T,{htmlFor:s,required:!!x,isError:!!((o=c._formState.errors)!=null&&o[s]),children:n}),e.jsx(S,{name:s,control:c,render:({field:t})=>{var l;return e.jsx(F,{id:s,type:"text",placeholder:a||n,disabled:t.disabled||d,defaultValue:t.value||"",className:v(((l=c._formState.errors)==null?void 0:l[s])&&!n&&"border-destructive focus:border-border !ring-destructive"),onInput:r=>{const g=h(r.currentTarget.value);r.currentTarget.value=g,t.onChange(g)},fullWidth:!0})}}),!m&&((u=c._formState.errors)==null?void 0:u[s])&&e.jsx(P,{className:"-mt-1",children:(i=c._formState.errors[s])==null?void 0:i.message})]})}function ie({open:s,setOpen:n,current:a}){const d=y(),x=k({from:"/_main"}),{post:m,patch:c,isPending:h}=C({onSuccess:i=>{a!=null&&a.id?d.setQueryData(["imb/contacts/",{}],t=>{var l;return{...t,results:(l=t==null?void 0:t.results)==null?void 0:l.map(r=>r.id===a.id?i:r)}}):d.setQueryData(["imb/contacts/",{}],t=>({...t,results:[...t.results,i]}))}},{contentType:"multipart/form-data"}),o=$({resolver:A(te),values:a!=null&&a.full_name?{full_name:a==null?void 0:a.full_name,phone:"998"+(a==null?void 0:a.phone),truck_id:a==null?void 0:a.truck_id}:void 0,disabled:h});async function u(i){var t,l;a!=null&&a.full_name?(await c("imb/contacts/"+a.id+"/",{...i,phone:(t=i==null?void 0:i.phone.slice(3))==null?void 0:t.split(" ").join("")}),_.success("Muvaffaqiyatli tahrirlandi"),n(!1),o.reset()):i.license_front||i.license_back||i.track_front||i.track_back||i.trailer_front||i.trailer_back?(await m("imb/contacts/",{...i,phone:(l=i==null?void 0:i.phone.slice(3))==null?void 0:l.split(" ").join("")}),_.success("Muvaffaqiyatli qo'shildi"),n(!1),o.reset()):_.error("Hamma rasmlarni kiriting"),d.invalidateQueries({queryKey:["imb/contacts/",{...x,tab:void 0}]})}return j.useEffect(()=>{s?a!=null&&a.full_name||o.reset({full_name:"",phone:""}):o.reset()},[s]),e.jsx(M,{open:s,onOpenChange:n,children:e.jsxs(R,{className:"w-full max-w-3xl pb-6",children:[e.jsxs(E,{children:[e.jsx(D,{className:"text-left",children:"Yangi kontakt"}),e.jsx(I,{})]}),e.jsx("div",{children:e.jsxs("form",{onSubmit:o.handleSubmit(u),className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(O,{methods:o,name:"full_name",label:"To'liq ismi"}),e.jsx(G,{control:o.control,name:"phone",label:"Telefon raqami",format:"+### ## ### ## ##"}),e.jsx(ae,{control:o.control,name:"truck_id",label:"Avtomobil raqami"}),e.jsx("div",{}),e.jsx(p,{control:o.control,name:"track_front",label:"Tirgach (oldi)"}),e.jsx(p,{control:o.control,name:"trailer_front",label:"Pritsep (oldi)"}),e.jsx(p,{control:o.control,name:"track_back",label:"Tirgach (orqa)"}),e.jsx(p,{control:o.control,name:"trailer_back",label:"Pritsept (orqa)"}),e.jsx(p,{control:o.control,name:"license_front",label:"Prava (oldi)"}),e.jsx(p,{control:o.control,name:"license_back",label:"Parava (orqa)"})]}),e.jsx(b,{icon:a!=null&&a.full_name?e.jsx(w,{width:18}):e.jsx(N,{width:18}),type:"submit",loading:h,className:"w-max ml-auto",children:a!=null&&a.full_name?"Tahrirlash":"Qo'shish"})]})})]})})}const te=f.object({full_name:f.string({message:""}).min(1,"To'liq ismini kiriting"),phone:f.string({message:""}).length(12),truck_id:f.string({message:""}).min(5,{message:""}),track_front:f.any({message:""}),track_back:f.any({message:""}),trailer_front:f.any({message:""}),trailer_back:f.any({message:""}),license_front:f.any({message:""}),license_back:f.any({message:""})}),oe=({c:s,onEdit:n})=>{var i,t;const{remove:a}=C(),d=y(),x=H(),{info:m}=Q(),c=k({from:"/_main"}),h=z("imb/contacts/$/");async function o(){await x({title:"O'chirilsinmi?"})&&_.promise(a(`imb/contacts/${s.id}/`),{loading:"O'chirilmoqda",success:()=>(d.setQueryData(["imb/contacts/",{...c,tab:void 0}],r=>({...r,results:r.results.filter(g=>g.id!==s.id)})),"Muvaffaqiyalti o'chirildi")})}function u(){const l=`
ðŸ“‹ Kontakt Tafsilotlari
- To'liq Ism: ${s.full_name}
- Telefon: ${s.phone}
- Avtomobil raqami: ${s.truck_id}
- Guvohnoma Oldi: ${s.license_front?s.license_front:"Mavjud emas"}
- Guvohnoma Orqa: ${s.license_back?s.license_back:"Mavjud emas"}
- Avtomobil Rasm: ${s.track_front?s.track_front:"Mavjud emas"}
- Avtomobil Rasm: ${s.track_back?s.track_back:"Mavjud emas"}
- Tirkama Oldi Rasm: ${s.trailer_front?s.trailer_front:"Mavjud emas"}
- Tirkama Orqa Rasm: ${s.trailer_back?s.trailer_back:"Mavjud emas"}
`,r=`https://t.me/share/url?url=${encodeURIComponent(l)}`;window.open(r,"_blank")}return e.jsx(Z,{className:"relative flex flex-col justify-between h-max overflow-hidden text-sm",children:e.jsxs(B,{className:"p-0",children:[((i=[s.track_front,s.track_back].filter(l=>typeof l=="string"))==null?void 0:i.length)>0&&e.jsx("div",{className:"w-full h-44",children:(t=[s.track_front,s.track_back].filter(l=>typeof l=="string"))==null?void 0:t.map((l,r)=>e.jsx(V,{d:{images:[{image:s==null?void 0:s.license_front},{image:s==null?void 0:s.license_back},{image:s==null?void 0:s.track_front},{image:s==null?void 0:s.track_back},{image:s==null?void 0:s.trailer_front},{image:s==null?void 0:s.trailer_back}].filter(g=>g.image)},children:e.jsx("img",{src:l,alt:"img",className:v("top-0 h-44 w-[200%] absolute object-cover",r===0?"-left-[52%]":"-right-[52%]")})},r))}),e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.full_name}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{className:"text-primary",children:s.truck_id}),e.jsx("span",{className:"text-muted-foreground",children:J(998+s.phone)})]})]}),h&&e.jsxs("div",{className:"flex",children:[(m==null?void 0:m.is_superuser)&&e.jsx(b,{icon:e.jsx(L,{width:18}),variant:"ghost",className:"!text-destructive",onClick:o}),e.jsx(b,{icon:e.jsx(w,{width:18}),variant:"ghost",onClick:n}),e.jsx(b,{icon:e.jsx(Y,{width:18}),variant:"ghost",onClick:u})]})]})]})})},le=()=>{var u;const[s,n]=j.useState(!1),[a,d]=j.useState(),x=k({from:"/_main"}),{data:m,isFetching:c}=K("imb/contacts/",{...x,tab:void 0}),{trigger:h,isFetching:o}=X({url:"imb/contacts-excel/",name:"Kontaktlar"});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsx(se,{options:[{label:"To'ldirilgan",value:"-image_count"},{label:"To'ldirilmagan",value:"image_count"}],paramName:"order",label:"To'ldirilganlik holati",returnVal:"value"}),e.jsx(W,{totalPages:m==null?void 0:m.total_pages,disabled:c}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{icon:e.jsx(ee,{width:18}),loading:o,onClick:h,children:"Yuklab olish"}),e.jsx(b,{icon:e.jsx(N,{width:18}),onClick:()=>{n(!0),d({})},children:"Kontakt"})]})]}),e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,_minmax(20rem,_auto))] gap-4 items-end",children:(u=m==null?void 0:m.results)==null?void 0:u.map((i,t)=>e.jsx(oe,{c:i,onEdit:()=>{n(!0),d(i)}},t))}),e.jsx(ie,{open:s,setOpen:n,current:a})]})},ke=U("/_main/_contacts/contacts")({component:()=>e.jsx(le,{})});export{ke as Route};
