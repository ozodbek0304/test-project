import{k as z,f as P,u as R,i as B,y as E,j as i,aj as J,l as f,R as N,U as q,B as j,W as M,ak as D,X as C,x as F,J as T,m as Q,r as S,C as $,c as I}from"./index-BuAxSJaU.js";import{u as L}from"./useConfirm-C4TJzy_o.js";import{D as O}from"./download-as-excel-C7gdF7ep.js";import{C as A}from"./collapsible-table-Cv61XwvC.js";import{B as G}from"./badge-EKaIYskS.js";import{C as K}from"./checkbox-BA3PB9sW.js";import{u as W}from"./useStatuses-B8z25-cP.js";import{f as Y}from"./format-phone-number-BkVnJ-Jf.js";import{M as H}from"./move-right-CEAOD2dZ.js";import{C as b}from"./pagination-BuI0EWJ8.js";import"./useDownloadAsExcel-B0QCkxlR.js";import"./cursor-pagination-BTjgdc8e.js";const U=()=>{const o=z({from:"/_main/_accounting/faktura"}),g=P(),{patch:k}=R(),_=B(),s=o==null?void 0:o.selecteds,u=(o==null?void 0:o.total_amount)||0;async function r(a,e){s!=null&&s.includes(a)?g({search:{selecteds:s==null?void 0:s.filter(n=>n!=a),total_amount:u-(Number(e)||0)}}):g({search:{selecteds:s!=null&&s.length?[...s,a]:[a],total_amount:u+(Number(e)||0)}})}function m(a,e){T.promise(k(`accountant/update-invoice/${a}/`,{status:e}),{loading:"O'zgartirilmoqda",success:()=>(_.invalidateQueries({queryKey:["accountant/invoice-orders/",{...o,selecteds:void 0}]}),"Muvaffaqiyatli o'zgartirildi")})}const v=E("accountant/update-invoice/$/");return[{header:"â„–",cell:({row:a})=>{var e,n,t,c,d,h,p;return a.original.accounting_phone?a.index+1:(e=a.original)!=null&&e.loading_name?i.jsxs(J,{className:"flex items-center gap-4",htmlFor:`checkbox-${(n=a.original)==null?void 0:n.id}`,children:[!((t=a.original)!=null&&t.invoice_id)&&i.jsx(K,{className:"data-[state=checked]:bg-transparent data-[state=checked]:text-primary",id:`checkbox-${(c=a.original)==null?void 0:c.id}`,onCheckedChange:()=>{var x,l;return r((x=a.original)==null?void 0:x.id,(l=a.original)==null?void 0:l.income)},checked:s==null?void 0:s.includes((d=a.original)==null?void 0:d.id)}),a.original.loading_name,i.jsx(H,{width:18,className:"text-primary"}),a.original.unloading_name]}):(p=(h=a.original.created_at)==null?void 0:h.slice(0,10))==null?void 0:p.split("-").join(".")}},{header:"Firm nomi",cell:({row:a})=>i.jsxs("div",{className:"flex flex-col",children:[a.original.customer," ",i.jsx("span",{className:"text-muted-foreground",children:a.original.inn})]})},{header:"Buxgalter raqami",cell:({row:a})=>{var e,n;return(e=a.original)!=null&&e.accounting_phone?Y(a.original.accounting_phone)||a.original.inn:(n=a==null?void 0:a.original)==null?void 0:n.car_number}},{header:"Jo'natilinmagan summa",cell:({row:a})=>{var e,n;return((e=a.original)==null?void 0:e.name)&&f((n=a.original.amounts)==null?void 0:n.unsent)}},{header:"Qarzdorlik",cell:({row:a})=>{var e,n,t;return(e=a.original)!=null&&e.name?f((n=a.original.amounts)==null?void 0:n.pending):f((t=a.original)!=null&&t.created_at?a.original.total_amount:a.original.income)}},{header:"To'lov qilingan",cell:({row:a})=>{var e,n;return((e=a.original)==null?void 0:e.name)&&f((n=a.original.amounts)==null?void 0:n.approved)}},{header:" ",cell:({row:a})=>{var e,n,t,c,d,h,p,x;return a.getCanExpand()?i.jsxs("div",{className:"flex gap-2 items-center justify-end",children:[((e=a.original)==null?void 0:e.status)=="pending"&&i.jsxs(N,{children:[v&&i.jsx(q,{asChild:!0,children:i.jsxs(j,{size:"sm",className:"h-6",onClick:l=>l.stopPropagation(),children:["Jarayonda ",i.jsx(b,{width:18})]})}),i.jsx(M,{onClick:l=>l.stopPropagation(),children:i.jsxs(D,{children:[i.jsx(C,{onClick:()=>m(a.original.id,"approved"),children:"To'lov qilingan"}),i.jsx(C,{onClick:()=>m(a.original.id,"cancelled"),children:"Bekor qilish"})]})})]}),((n=a.original)==null?void 0:n.status)=="approved"&&i.jsxs(N,{children:[v&&i.jsx(q,{asChild:!0,children:i.jsxs(j,{size:"sm",className:"h-6 !bg-green-500",onClick:l=>l.stopPropagation(),children:["To'lov qilingan"," ",i.jsx(b,{width:18})]})}),i.jsx(M,{onClick:l=>l.stopPropagation(),children:i.jsxs(D,{children:[i.jsx(C,{onClick:()=>m(a.original.id,"pending"),children:"Jarayonda"}),i.jsx(C,{onClick:()=>m(a.original.id,"cancelled"),children:"Bekor qilish"})]})})]}),!((t=a.original)!=null&&t.status)&&!((c=a.original)!=null&&c.accounting_phone)&&i.jsx(j,{size:"sm",className:"h-6",variant:"destructive",children:"Faktura berilmagan"}),i.jsx(b,{className:F("text-muted-foreground",a.getIsExpanded()?"rotate-0":"-rotate-90",(d=a.original)!=null&&d.accounting_phone?"":"w-5 mr-2")})]}):!((h=a.original)!=null&&h.name)&&i.jsx(G,{children:(x=(p=W())==null?void 0:p.find(l=>{var y;return l.value==((y=a.original)==null?void 0:y.status)}))==null?void 0:x.label})}}]},X=()=>{var n;const o=z({from:"/_main"}),g=P(),k=L(),_=B(),s=o==null?void 0:o.total_amount,u=o==null?void 0:o.selecteds,{data:r,isLoading:m}=Q("accountant/invoice-orders/",{...o,selecteds:void 0},{refetchOnMount:!0,refetchOnWindowFocus:!0}),{post:v,isPending:a}=R();async function e(){await k({title:"Tasdiqlansinmi?"})&&T.promise(v("accountant/create-invoice/",{orders:u}).then(()=>{_.invalidateQueries({queryKey:["accountant/invoice-orders/",{...o,selecteds:void 0}]}),g({search:{...o,selecteds:void 0,total_amount:void 0}})}),{loading:"Yuborilmoqda",success:"Muvaffaqiyatli yuborildi"})}return S.useEffect(()=>{g({search:{...o,selecteds:void 0,total_amount:void 0}})},[]),i.jsx(A,{columns:U(),data:(n=r==null?void 0:r.results)==null?void 0:n.map(t=>{var c;return{...t,subRows:(c=t.invoices)==null?void 0:c.map(d=>({...d,subRows:d.to_orders}))}}),loading:m,paginationProps:{totalPages:r==null?void 0:r.total_pages},head:i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between  gap-4",children:[i.jsx("h3",{className:"text-lg sm:text-xl font-medium",children:"Hisob faktura"}),i.jsxs("div",{className:"flex gap-2 flex-col sm:flex-row",children:[i.jsxs(j,{variant:"secondary",children:["Jami qarzdorlik: ",f(Number(s))]}),i.jsx(j,{icon:i.jsx($,{width:18}),onClick:e,disabled:!(u!=null&&u.length)||a,children:"Yuborish"}),i.jsx(O,{url:"",name:""})]})]})})},ca=I("/_main/_accounting/faktura")({component:()=>i.jsx(X,{})});export{ca as Route};
