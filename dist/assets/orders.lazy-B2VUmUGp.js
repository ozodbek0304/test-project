import{r as h,a as z,u as M,y as b,j as e,B as p,x as C,P as R,J as j,G as _,k as q,n as D,c as $}from"./index-BuAxSJaU.js";import{C as B,c as F,d as k}from"./card-DPoa1Zzb.js";import{u as L}from"./usePrompt-Dl5wsuex.js";import{U as S,C as I,f as O,a as P}from"./format-D8QO3V0g.js";import{A as U,T as E}from"./trash-2-DM4hDO8P.js";import{U as Q}from"./undo-2-Ba1fajE1.js";import{L as T}from"./loading-CtOmVY-o.js";import{P as X}from"./combobox-BXG5K80F.js";import{u as A}from"./useSocket-LLKPNFXH.js";function J(s){const[a,d]=h.useState(0);h.useEffect(()=>{const i=new Date,l=+new Date(s.created_at)-+i,x=20*60-l/1e3;d(x);const f=setInterval(()=>{d(m=>m>0?m-1:0)},6e4);return()=>clearInterval(f)},[]);const t=Math.floor(a/3600),r=Math.floor(a%3600/60);return{hours:t,minutes:r}}const G=({c:s})=>{var g,y,N,v;const{info:a}=z(),{remove:d}=M(),t=L(),r=b("dispatchers/book-order/$/"),i=b("managers/delete-order/$/"),{hours:u,minutes:l}=J({created_at:s.created_at});async function x(){j.promise(_.get(`dispatchers/book-order/${s.id}/`),{loading:"Band qilinmoqda",success:"Muvaffaqiyatli band qilindi",error:n=>{var o,c;return((c=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:c.detail)||"Xatolik yuz berdi"}})}async function f(){j.promise(_.get(`dispatchers/book-order/${s.id}/`),{loading:"Qaytarilmoqda",success:"Muvaffaqiyatli qaytarildi",error:n=>{var o,c;return((c=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:c.detail)||"Xatolik yuz berdi"}})}async function m(){const n=await t();n&&j.promise(d(`managers/delete-order/${s.id}/`,{comment:n}),{loading:"O'chirilmoqda",success:"Muvaffaqiyatli o'chirildi",error:o=>{var c,w;return((w=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:w.detail)||"Xatolik yuz berdi"}})}return e.jsxs(B,{className:"relative flex flex-col justify-between overflow-hidden text-sm",children:[e.jsxs(F,{className:"p-4 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{width:18,className:"text-muted-foreground"}),e.jsx("span",{className:"text-primary text-xs ",children:s.client})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{width:16,className:"text-muted-foreground"}),e.jsx("span",{className:"text-primary text-xs",children:O(new Date(s.date),"dd.MM.yy")})]})]}),e.jsxs("div",{className:"flex justify-between items-center pb-1",children:[e.jsx("p",{className:"font-medium text-mine",children:s.loading}),e.jsx(U,{width:20,className:"text-primary"}),e.jsx("p",{className:"font-medium text-mine",children:s.unloading})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"rounded-md bg-secondary flex items-center gap-1.5 px-2 py-1 w-max",children:[e.jsx(P,{width:16,className:"text-muted-foreground"}),u>0?`${u} soat`:""," ",l<10?`${l}`:l," minut"]}),s.payment_type==="cash"?e.jsx("div",{className:"rounded-md bg-secondary flex items-center gap-1.5 px-2 h-8 w-max",children:e.jsx("img",{src:"/cash.svg",alt:""})}):e.jsx("img",{src:"/transfer.svg",alt:""})]}),e.jsx("p",{className:"text-muted-foreground",children:s.comment})]}),r&&e.jsx(e.Fragment,{children:(g=s==null?void 0:s.dispatcher)!=null&&g.id?e.jsxs(k,{className:"pt-0 flex gap-2",children:[i&&e.jsx("div",{children:e.jsx(p,{icon:e.jsx(E,{width:16,size:"sm",className:"!text-destructive"}),variant:"ghost",onClick:m})}),(a==null?void 0:a.id)===((y=s==null?void 0:s.dispatcher)==null?void 0:y.id)?e.jsx(p,{icon:e.jsx(Q,{width:16}),size:"sm",variant:"outline",className:"w-full",onClick:f,children:"Qaytarish"}):e.jsxs(p,{className:C("w-full"),size:"sm",variant:"ghost",children:[(N=s==null?void 0:s.dispatcher)==null?void 0:N.first_name," ",(v=s==null?void 0:s.dispatcher)==null?void 0:v.last_name]})]}):e.jsx(k,{className:"pt-0",children:e.jsx(p,{className:C("w-full"),size:"sm",icon:e.jsx(R,{size:16}),onClick:x,children:"Band qilish"})})})]})},V=s=>{const[a,d]=h.useState(s||[]),t=q({from:"/_main"}),r=h.useMemo(()=>{var l;if(!(s!=null&&s.length)||!(t!=null&&t.search_term))return s||[];const i=typeof t.search_term!="number"?(l=t==null?void 0:t.search_term)==null?void 0:l.toLowerCase():t.search_term,u=Object.keys(s[0]);return s.filter(x=>u.some(f=>{var m;return(m=x[f])==null?void 0:m.toString().toLowerCase().includes(i)}))},[s,t==null?void 0:t.search_term]);return h.useEffect(()=>{d(r)},[r]),a||[]},H=()=>{var r;const s=q({from:"/_main"}),{data:a,isLoading:d}=A("dispatchers/new-orders/","dispatcher-orders"),t=(r=V(a))==null?void 0:r.filter(i=>!s.client||i.client==s.client);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"head-div !justify-end flex-col",children:e.jsx(X,{paramName:"client",options:D().clients,label:"Buyurtmachi",returnVal:"label"})}),e.jsx(T,{loading:d,children:e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,_minmax(20.5rem,_auto))] gap-4 md:gap-6",children:t==null?void 0:t.map(i=>e.jsx(G,{c:i},i.id))})})]})},ne=$("/_main/_dispatcher/orders")({component:()=>e.jsx(H,{})});export{ne as Route};
