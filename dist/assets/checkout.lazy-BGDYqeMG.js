import{z as j,i as b,k as S,u as z,J as w,b as _,t as A,r as N,j as e,D as I,p as M,q as R,s as E,V as L,v as O,F as B,g as D,B as r,m as C,y as v,P as H,l as F,C as J,c as U}from"./index-BuAxSJaU.js";import{P as V}from"./tabs-xOTve4x4.js";import{D as W}from"./download-as-excel-C7gdF7ep.js";import{D as $}from"./datatable-BQkt-0G4.js";import{u as G}from"./useConfirm-C4TJzy_o.js";import{u as X}from"./usePrompt-Dl5wsuex.js";import{U as Y}from"./undo-2-Ba1fajE1.js";import"./badge-EKaIYskS.js";import"./useDownloadAsExcel-B0QCkxlR.js";import"./cursor-pagination-BTjgdc8e.js";import"./pagination-BuI0EWJ8.js";function Z({open:s,setOpen:t}){const i=b(),x=S({from:"/_main"}),{post:g,isPending:h}=z({onSuccess:u=>{t(!1),w.success("Muvaffaqiyatli jo'natildi"),o.reset(),i.setQueryData(["checkout/transactions/",x],c=>({...c,results:(c==null?void 0:c.results.length)>0?[...c.results,u]:[u]}))}}),o=_({resolver:A(ee),disabled:h});function f(){o.reset(),t(!1)}N.useEffect(()=>{s||o.reset()},[s,o]);async function l(u){await g("checkout/transactions/",u)}return e.jsx(I,{open:s,onOpenChange:t,children:e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx(E,{children:"Chiqim qo'shish"}),e.jsx(L,{children:e.jsx(O,{children:"Chiqim qo'shish"})})]}),e.jsxs("form",{onSubmit:o.handleSubmit(l),className:"space-y-4",children:[e.jsx(B,{control:o.control,name:"amount",label:"Summa",thousandSeparator:"  "}),e.jsx(D,{methods:o,name:"comment",label:"Izoh"}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(r,{loading:h,children:"Tasdiqlash"}),e.jsx(r,{variant:"secondary",type:"button",onClick:f,children:"Bekor qilish"})]})]})]})})}const ee=j.object({amount:j.string({message:"Summani kiriting"}).nonempty(),comment:j.string({message:""})}),se=()=>{const[s,t]=N.useState(!1),i=S({from:"/_main"}),x=G(),g=X(),h=b(),{put:o,isPending:f}=z(),{data:l,isLoading:u}=C("checkout/transactions/",{...i,type:"income"},{refetchOnMount:!0,refetchOnWindowFocus:!0}),{data:c,isLoading:P}=C("checkout/transactions/",{...i,type:"expense"},{refetchOnMount:!0,refetchOnWindowFocus:!0});async function k(a,n){const m=n&&await x({title:"Tasdiqlansinmi?"}),d=n?void 0:await g();(m||d)&&(await o(`checkout/transactions/${a}/`,{status:n?"approved":"cancelled",rejected:d}),h.setQueryData(["checkout/transactions/",{...i,type:i.type||"income"}],p=>{var q;return{...p,results:(q=p==null?void 0:p.results)==null?void 0:q.map(y=>y.id===a?{...y,status:n?"approved":"cancelled",rejected:d}:y)}}),h.invalidateQueries({queryKey:["checkout/balance-info/"]}),w.success("Muvaffaqiyatli o'zgartirildi"))}const K=v("checkout/transactions/$/"),Q=v("checkout/transactions/"),T=[{header:"№",cell:({row:a})=>a.index+1},{header:"Sana",cell:({row:a})=>{var n,m,d;return(d=(m=(n=a.original)==null?void 0:n.created_at)==null?void 0:m.slice(0,10))==null?void 0:d.split("/").join(".")}},{header:"Summa",cell:({row:a})=>{var n;return F((n=a.original)==null?void 0:n.amount)}},{header:"Izoh",accessorKey:"comment"},{header:"Qaytarish izohi",accessorKey:"rejected"},{header:" ",cell:({row:a})=>{var n,m;return K&&((n=a.original)==null?void 0:n.status)==="pending"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{className:"!bg-green-500",icon:e.jsx(J,{width:16}),size:"sm",onClick:()=>k(a.original.id,!0),children:"Tasdiqlash"}),e.jsx(r,{icon:e.jsx(Y,{width:16}),size:"sm",variant:"destructive",onClick:()=>k(a.original.id,!1),children:"Qaytarish"})]}):((m=a.original)==null?void 0:m.status)==="approved"?e.jsx(r,{size:"sm",className:"!bg-green-500",children:"Tasdiqlangan"}):e.jsx(r,{size:"sm",variant:"destructive",children:"Qaytarilgan"})}}];return e.jsxs(e.Fragment,{children:[e.jsx($,{columns:i.type==="expense"?ae:T,data:i.type==="expense"?c==null?void 0:c.results:l==null?void 0:l.results,paginationProps:{totalPages:i.type==="expense"?c==null?void 0:c.total_pages:l==null?void 0:l.total_pages},loading:u||P||f,head:e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsx(V,{paramName:"type",options:[{label:"Kirim",value:"income"},{label:"Chiqim",value:"expense"}]}),e.jsxs("div",{className:"flex gap-x-4 gap-y-2 flex-wrap",children:[e.jsx(W,{name:i.type==="expense"?"Chiqimlar":"Kirimlar",url:i.type==="expense"?"checkout/transactions-excel/?type=expense":"checkout/transactions-excel/?type=income"}),i.type==="expense"&&Q&&e.jsx(r,{icon:e.jsx(H,{width:20}),onClick:()=>t(!0),children:"Chiqim"})]})]})}),e.jsx(Z,{open:s,setOpen:t})]})},ae=[{header:"№",cell:({row:s})=>s.index+1},{header:"Sana",cell:({row:s})=>{var t;return(t=s.original)==null?void 0:t.created_at}},{header:"Summa",cell:({row:s})=>{var t;return F((t=s.original)==null?void 0:t.amount)}},{header:"Izoh",accessorKey:"comment"},{header:"Qaytarish izohi",accessorKey:"rejected"},{header:"Status",cell:({row:s})=>s.original.status==="pending"?e.jsx(r,{size:"sm",children:"Kutilmoqda"}):e.jsx(r,{size:"sm",className:"!bg-green-500",children:"Tasdiqlangan"})}],pe=U("/_main/_manager/checkout")({component:()=>e.jsx(se,{})});export{pe as Route};
