import{y as p,j as e,B as u,C as b,z as c,u as y,i as N,k as x,b as C,t as D,r as h,D as S,p as q,q as v,s as _,V as F,v as k,g as B,F as O,J as P,m as R,c as z}from"./index-BuAxSJaU.js";import{D as E}from"./datatable-BQkt-0G4.js";import{S as I}from"./see-in-view-BUqfdvd-.js";import{f as g}from"./format-phone-number-BkVnJ-Jf.js";import{F as T}from"./phone-number-DAgSYITq.js";import{D as w}from"./download-as-excel-C7gdF7ep.js";import"./cursor-pagination-BTjgdc8e.js";import"./pagination-BuI0EWJ8.js";import"./useDownloadAsExcel-B0QCkxlR.js";const A=({handleForm:t})=>{const o=p("accountant/clients/$/");return[{header:"â„–",cell:({row:n})=>n.index+1},{header:"Buyurtmachi",cell:({row:n})=>{var s,i;return e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsx("span",{children:(s=n.original)==null?void 0:s.name}),e.jsx("span",{className:"text-muted-foreground",children:g((i=n.original)==null?void 0:i.phone)})]})}},{header:"Buxgalter raqami",cell:({row:n})=>{var s,i;return e.jsx("a",{href:`tel:${(s=n.original)==null?void 0:s.accounting_phone}`,className:"flex items-center gap-2",children:g((i=n.original)==null?void 0:i.accounting_phone)})}},{header:"Rekvizit",cell:({row:n})=>{var s,i,a;return(s=n.original)!=null&&s.requisite?(i=n.original)==null?void 0:i.requisite:e.jsx(I,{url:((a=n.original)==null?void 0:a.requisite_file)||"",className:"w-8 h-8 rounded object-cover"})}},{header:"Amallar",cell:({row:n})=>{var s;return!((s=n.original)!=null&&s.inn)&&e.jsx(u,{icon:e.jsx(b,{width:16}),variant:"ghost",className:"!text-green-500",size:"sm",onClick:()=>t(n.original)})}}].slice(0,o?7:6)};function M(t){var r;const{patch:o,isPending:n}=y(),s=N(),i=x({from:"/_main"}),a=C({resolver:D(V),disabled:n,values:{accountant_number:(r=t.d)==null?void 0:r.accounting_phone,inn:"",customer:""}});async function l(f){await o(`accountant/clients/${t.d.id}/`,f),t.setOpen(!1),P.success("Muvaffaqiyatli tasdiqlandi"),s.setQueryData(["accountant/clients/",i],d=>({...d,results:d.results.filter(j=>j.id!==t.d.id)}))}function m(){t.setOpen(!1),a.reset()}return h.useEffect(()=>{t.open||a.reset()},[t.open,a]),e.jsx(S,{open:t.open,onOpenChange:t.setOpen,children:e.jsxs(q,{className:"sm:max-w-[425px]",children:[e.jsxs(v,{children:[e.jsx(_,{children:"Shartnoma ma'lumotlari"}),e.jsx(F,{children:e.jsx(k,{children:"Shartnoma ma'lumotlari"})})]}),e.jsxs("form",{onSubmit:a.handleSubmit(l),className:"space-y-4",children:[e.jsx(B,{methods:a,name:"customer",label:"Tashuvchi nomi"}),e.jsx(O,{control:a.control,name:"inn",label:"INN"}),e.jsx(T,{control:a.control,name:"accountant_number",label:"Buxgalter raqami"}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(u,{children:"Tasdiqlash"}),e.jsx(u,{variant:"secondary",type:"button",onClick:m,children:"Bekor qilish"})]})]})]})})}const V=c.object({customer:c.string({message:""}).nonempty({message:""}),inn:c.string({message:""}).nonempty({message:""}).length(9,{message:""}),accountant_number:c.string({message:""}).nonempty({message:""}).length(12,{message:""})}),$=()=>{const[t,o]=h.useState(!1),[n,s]=h.useState(),i=x({from:"/_main"}),{data:a,isLoading:l}=R("accountant/clients/",i,{refetchOnMount:!0,refetchOnWindowFocus:!0});async function m(r){o(!0),s(r)}return e.jsxs(e.Fragment,{children:[e.jsx(E,{columns:A({handleForm:m}),data:a==null?void 0:a.results,loading:l,paginationProps:{totalPages:a==null?void 0:a.total_pages},head:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-medium",children:"Shartnoma"}),e.jsx(w,{url:"accountant/clients-excel/",name:"Buxgalteriya-Shartnomalar"})]})}),e.jsx(M,{d:n,open:t,setOpen:o})]})},Y=z("/_main/_accounting/contract")({component:()=>e.jsx($,{})});export{Y as Route};
